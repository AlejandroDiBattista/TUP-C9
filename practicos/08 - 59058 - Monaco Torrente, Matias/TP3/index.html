<!DOCTYPE html>
<html lang="es">

    <head>
        <meta charset="UTF-8">
        <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

        <style>

body {

    font-family: 'Roboto', sans-serif;

    background-color: #f5f5f5;

    margin: 0;

    padding: 20px;

}


h1 {

    color: #4caf50;

    text-align: center;

    margin-bottom: 20px;

    font-size: 36px;

}

.renovar-stock {

    font-size: 24px;

    font-weight: bold;

    text-align: center;

    color: #ff5722;

}

.inputs {

    border-radius: 5px;

    width: calc(100% - 22px);

    font-size: 16px;

    padding: 10px;

    margin-bottom: 10px;

    border: 1px solid #ccc;

    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);

}

.contenedor {

    display: flex;

    align-items: center;

    justify-content: center;

    margin-bottom: 20px;

}

.btn-guardar,

.btn-cancelar {

    font-size: 15px;

    padding: 10px 20px;

    color: white;

    border: none;

    border-radius: 5px;

    margin: 10px;

    cursor: pointer;

    transition: background-color 0.3s ease;

}

.btn-guardar:hover {

    background-color: #388e3c;

}

.btn-cancelar:hover {

    background-color: #b71c1c;

}

.btn-guardar {

    background-color: #4caf50;

}

.btn-cancelar {

    background-color: #f44336;

}

.btn-agregar {

    font-size: 18px;

    padding: 10px 20px;

    color: white;

    background-color: #4caf50;

    border: none;

    border-radius: 5px;

    cursor: pointer;

    display: block;

    margin: 20px auto;

    transition: background-color 0.3s ease;

}

.btn-agregar:hover {

    background-color: #388e3c;

}

.btn-editar,

.btn-borrar {

    font-size: 20px;

    color: #4caf50;

    background: none;

    border: none;

    cursor: pointer;

    transition: color 0.3s ease;

}

.btn-editar:hover,

.btn-borrar:hover {

    color: #2e7d32;

}

.panel {

    position: relative;
    background-color: #ffffff;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 20px;
    margin: 10px auto;
    width: 90%;
    max-width: 600px;
    display: flex;
  flex-direction: column;
    align-items: flex-start;
    transition: transform 0.3s ease;

}

.panel:hover {

    transform: scale(1.02);

}

.contenido {

    display: flex;

    align-items: center;

    justify-content: space-between;

    width: 100%;

}

.acciones {

    display: flex;

    align-items: center;

    justify-content: space-between;

    width: 60px;

}

.cantidad {

    font-size: 40px;

    font-weight: bold;

    color: #4caf50;

}

.nombre {

    color: #4caf50;

    font-size: 24px;

    font-weight: bold;

}

.codigo {

    color: #757575;

    font-size: 16px;

}

        .edit-form {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .edit-form label {
            margin: 5px 0;
            font-weight: bold;
        }

        .edit-form input {
            margin-bottom: 10px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .actions {
            display: flex;
            justify-content: space-between;
        }

        .actions button {
            font-size: 15px;
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            transition: background-color 0.3s ease;
        }

        .save {
            background-color: #4caf50;
        }

        .save:hover {
            background-color: #388e3c;
        }

        .cancel {
            background-color: #f44336;
        }

        .cancel:hover {
            background-color: #b71c1c;
        }

        .error {
            color: #f44336;
            font-weight: bold;
        }
    </style>
    </head>

    <body>
        <div id="root"></div>
        <script type="text/babel">
        const { useState } = React;

        function Editar({ producto, alGuardar, alCancelar }) {
            const [nombre, setNombre] = useState(producto.nombre || '');
            const [codigoEAN, setCodigoEAN] = useState(producto.codigoEAN || '');
            const [cantidad, setCantidad] = useState(producto.cantidad || 1);
            const [error, setError] = useState(false);

            const cambiarNombre = e => {
                setNombre(e.target.value);
                setError(false);
            };

            const cambiarCodigoEAN = e => {
                setCodigoEAN(e.target.value);
                setError(false);
            };

            const cambiarCantidad = e => {
                const newValue = parseInt(e.target.value);
                if (!isNaN(newValue) && newValue >= 0 && newValue <= 100) {
                    setCantidad(newValue);
                    setError(false);
                } else if (newValue > 100) {
                    setCantidad(100);
                    setError(false);
                } else {
                    setError(true);
                }
            };

            const handleKeyDown = e => {
                if (e.key === 'Backspace') {
                    const currentValue = e.target.value;
                    if (currentValue.length === 1) { 
                        setCantidad(0);
                        setError(false);
                    }
                }
            };

            const guardar = e => {
                e.preventDefault();
                if (nombre.trim() === '' || codigoEAN.trim() === '' || cantidad <= 0) {
                    setError(true);
                    return;
                }
                alGuardar({ ...producto, nombre, codigoEAN, cantidad, editando: false });
            };

            const cancelar = e => {
                e.preventDefault();
                alCancelar();
            };

            return (
                <form className="edit-form">
                    <label>Nombre</label>
                    <input type="text" value={nombre} onChange={cambiarNombre} />
                    <label>CÃ³digo EAN</label>
                    <input type="text" value={codigoEAN} onChange={cambiarCodigoEAN} />
                    <label>Cantidad</label>
                    <input type="number" value={cantidad} onChange={cambiarCantidad} onKeyDown={handleKeyDown} />
                    {error && <p className="error">Todos los campos son obligatorios y la cantidad debe ser mayor que 0</p>}
                    <div className="actions">
                        <button className="save" onClick={guardar}>Aceptar</button>
                        <button className="cancel" onClick={cancelar}>Cancelar</button>
                    </div>
                </form>
            );
        }

        const Mostrar = ({ producto, alGuardar, alBorrar, incrementarCant }) => {
            const [editando, setEditando] = useState(false);

            const toggleEdit = () => setEditando(!editando);

            return (
                <div className="panel">
                    {editando && (
                        <Editar
                            producto={producto}
                            alGuardar={(productoEditado) => { alGuardar(productoEditado); setEditando(false); }}
                            alCancelar={() => setEditando(false)}
                        />
                    )}
                    {!editando && (
                        <>
                            <div className="quantity" onClick={() => incrementarCant(producto.id)}>
                                {producto.cantidad}
                            </div>
                            <div className="details">
                                <p className="name">{producto.nombre}</p>
                                <p className="ean">{producto.codigoEAN}</p>
                            </div>
                            <div className="edit-button-container">
                                <button className="edit-button" onClick={toggleEdit} title="Editar">
                                    <i className=" fa-regular fa-pen-to-square"></i>
                                </button>
                            </div>
                            <div className="actions">
                                <button className="delete-button" onClick={() => alBorrar(producto.id)} title="Eliminar">
                                    <i className="fa-regular fa-trash-can"></i>
                                </button>
                            </div>
                        </>
                    )}
                </div>
            );
        };

        function App() {
            const [productos, setProductos] = useState([
                { id: 1, nombre: 'Coca Cola', codigoEAN: '1234567890123', cantidad: 10 },
                { id: 2, nombre: 'Pepsi', codigoEAN: '2345678901234', cantidad: 8 },
                { id: 3, nombre: 'Fanta', codigoEAN: '3456789012345', cantidad: 5 },
                { id: 4, nombre: 'Sprite', codigoEAN: '4567890123456', cantidad: 3 },
                { id: 5, nombre: '7Up', codigoEAN: '5678901234567', cantidad: 12 }
            ].sort((a, b) => a.nombre.localeCompare(b.nombre)));

            const agregarProducto = () => {
                const nuevoProducto = {
                    id: Math.max(...productos.map(p => p.id)) + 1,
                    nombre: '',
                    codigoEAN: '',
                    cantidad: 1,
                    editando: true
                };
                setProductos([nuevoProducto, ...productos]);
            };

            const actualizarProducto = productoActualizado => {
                setProductos(prevProductos => prevProductos.map(p =>
                    p.id === productoActualizado.id ? productoActualizado : p
                ).sort((a, b) => a.nombre.localeCompare(b.nombre)));
            };

            const borrarProducto = id => {
                setProductos(prevProductos => prevProductos.filter(p => p.id !== id));
            };

            const incrementarCantidad = id => {
                setProductos(prevProductos => prevProductos.map(p =>
                    p.id === id ? { ...p, cantidad: p.cantidad < 100 ? p.cantidad + 1 : p.cantidad } : p
                ));
            };

            return (
                <div id="root">
                    <div className="header">
                        <h1>Lista de Productos</h1>
                        <button className="btn-agregar" onClick={agregarProducto}>Agregar Producto</button>
                    </div>
                    {productos.map(producto => (
                        <Mostrar
                            key={producto.id}
                            producto={producto}
                            alGuardar={actualizarProducto}
                            alBorrar={borrarProducto}
                            incrementarCant={incrementarCantidad}
                        />
                    ))}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    </body>

</html>
