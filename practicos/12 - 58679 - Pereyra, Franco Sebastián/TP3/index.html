<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Distribuidora de Bebidas</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <style>
      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .formulario, .panel {
        display: flex;
        flex-wrap: wrap;
        flex-direction: column;
        width: 300px;
        padding: 20px;
        border: 1px solid rgba(85, 81, 81, 0.521);
        margin: 20px;
        border-radius: 15px;
      }
      .formulario label, .panel label {
        font-size: 20px;
        font-family: "Franklin Gothic Medium", "Arial Narrow", Arial, sans-serif;
      }
      .formulario input, .panel input {
        padding: 10px;
        border-radius: 10px;
        border: 1px solid black;
        width: calc(100% - 22px);
      }
      .acciones {
        display: flex;
        justify-content: space-around;
        margin-top: 10px;
      }
      .botonAgregar {
        background-color: rgb(0, 195, 255);
        color: white;
        border: none;
        border-radius: 5px;
        width: 150px;
        height: 30px;
        cursor: pointer;
        margin-left: 10px;
      }
      .acciones button{
        background-color: rgb(0, 195, 255);
        color: white;
        border: none;
        border-radius: 5px;
        width: 100px;
        height: 30px;
        cursor: pointer;
        margin-left: 10px;
      }
      .cant {
        font-size: 50px;
        color: red;
        order: -1;
      }
      .error {
        color: red;
        margin-top: 10px;
        width: 100%;
      }
      .botonEditar {
        background-color: rgb(0, 195, 255);
        color: black;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;

      const DepositoProductos = [
        { id: 1, producto: "Coca Cola", codigoEan: "123456789012", cantidad: "10" },
        { id: 2, producto: "Pepsi", codigoEan: "987654321098", cantidad: "20" },
        { id: 3, producto: "Fanta", codigoEan: "456789012345", cantidad: "30" },
        { id: 4, producto: "Sprite", codigoEan: "789012345678", cantidad: "15" },
        { id: 5, producto: "Mirinda", codigoEan: "012345678901", cantidad: "25" },
        { id: 6, producto: "7 Up", codigoEan: "567890123456", cantidad: "35" },
        { id: 7, producto: "Speed", codigoEan: "234567890123", cantidad: "18" },
        { id: 8, producto: "Monster", codigoEan: "890123456789", cantidad: "22" },
        { id: 9, producto: "Manaos", codigoEan: "345678901234", cantidad: "28" },
        { id: 10, producto: "Bichi Cola", codigoEan: "678901234567", cantidad: "40" },
        { id: 11, producto: "Red Bull", codigoEan: "112233445566", cantidad: "50" },
        { id: 12, producto: "Mountain Dew", codigoEan: "998877665544", cantidad: "45" },
        { id: 13, producto: "Dr. Pepper", codigoEan: "332211445566", cantidad: "38" },
        { id: 14, producto: "Rockstar", codigoEan: "556677889900", cantidad: "55" },
        { id: 15, producto: "Sunkist", codigoEan: "443322110088", cantidad: "42" },
        { id: 16, producto: "Gatorade", codigoEan: "123987654321", cantidad: "60" },
        { id: 17, producto: "Monster Ultra", codigoEan: "456789012345", cantidad: "70" },
        { id: 18, producto: "Arizona Iced Tea", codigoEan: "987654321012", cantidad: "55" },
        { id: 19, producto: "Vitaminwater", codigoEan: "876543210987", cantidad: "48" },
        { id: 20, producto: "Aloe Vera Drink", codigoEan: "210987654321", cantidad: "32" }
      ];
      function Editar({ productos, alGuardar, alCancelar }) {
        let [producto, setProducto] = useState(productos.producto);
        let [codigoEan, setCodigoEan] = useState(productos.codigoEan);
        let [cantidad, setCantidad] = useState(productos.cantidad);
        let [error, setError] = useState(false);

        const cambiarProducto = (e) => {
          setProducto(e.target.value);
          setError(false);
        };
        const cambiarCodigoEan = (e) => {
          setCodigoEan(e.target.value);
          setError(false);
        };
        const cambiarCantidad = (e) => {
          setCantidad(e.target.value);
          setError(false);
        };

        const guardar = (e) => {
          e.preventDefault();
          if (!producto || !codigoEan || !cantidad || producto.trim() === "" || codigoEan.trim() === "" || cantidad.trim() === "") {
            setError(true);
            return;
          }
          alGuardar({ ...productos, producto, codigoEan, cantidad });
        };
        const cancelar = (e) => {
          e.preventDefault();
          alCancelar();
        };

        return (
          <form className="formulario">
            <label>Producto</label>
            <input type="text" value={producto} onChange={cambiarProducto} />

            <label>Codigo EAN</label>
            <input type="text" value={codigoEan} onChange={cambiarCodigoEan} />

            <label>Cantidad</label>
            <input type="text" value={cantidad} onChange={cambiarCantidad} />

            {error && <p className="error">Todos los campos son obligatorios</p>}
            <div className="acciones">
              <button onClick={guardar} className="botonGuardar">Guardar</button>
              <button onClick={cancelar} className="botonCancelar" >Cancelar</button>
            </div>
          </form>
        );
      }

      function Mostrar({ deposito, alEditar, alBorrar }) {
        const [editando, setEditando] = useState(false);

        const editar = () => {
          setEditando(true);
        };

        const cancelar = () => {
          setEditando(false);
        };

        return (
          <>
            {editando ? (
              <Editar
                productos={deposito}
                alGuardar={(actualizado) => {
                  alEditar(actualizado);
                  setEditando(false);
                }}
                alCancelar={cancelar}
              />
            ) : (
              <div className="panel">
                <p>{deposito.producto}</p>
                <p>{deposito.codigoEan}</p>
                <p className="cant">{deposito.cantidad}</p>
                <div className="acciones">
                  <button onClick={editar} className="botonEdit">Editar</button>
                  <button onClick={alBorrar} className="botonDelete">Borrar</button>
                </div>
              </div>
            )}
          </>
        );
      }

      function Catalogo({ depositos, alAgregar, alEditar, alBorrar }) {
        const [nuevo, setNuevo] = useState(false);

        const cancelar = () => {
          setNuevo(false);
        };

        return (
          <>
            <h1>Cat√°logo de Bebidas</h1>
            <button onClick={() => setNuevo(true)} className="botonAgregar">Agregar Producto</button>
            {nuevo && (
              <Editar
                productos={{ id: null, producto: "", codigoEan: "", cantidad: "" }}
                alGuardar={(nuevoProducto) => {
                  alAgregar(nuevoProducto);
                  setNuevo(false);
                }}
                alCancelar={cancelar}
              />
            )}
            {depositos.length === 0 && <h2>No Hay Bebidas</h2>}
            {depositos.map((deposito) => (
              <Mostrar
                key={deposito.id}
                deposito={deposito}
                alEditar={(actualizado) => alEditar(deposito.id, actualizado)}
                alBorrar={() => alBorrar(deposito.id)}
              />
            ))}
          </>
        );
      }
      function App() {
        let [depositos, setDepositos] = useState(() => {
          const data = localStorage.getItem("depositos");
          return data ? JSON.parse(data) : DepositoProductos;
        });

        useEffect(() => {
          localStorage.setItem("depositos", JSON.stringify(depositos));
        }, [depositos]);

        const agregar = (nuevoProducto) => {
          let id = Math.max(...depositos.map((d) => d.id)) + 1;
          setDepositos([...depositos, { ...nuevoProducto, id }]);
        };

        const editar = (id, actualizado) => {
          let copia = depositos.map((d) => (d.id === id ? actualizado : d));
          setDepositos(copia);
        };

        const borrar = (id) => {
          let copia = depositos.filter((d) => d.id !== id);
          setDepositos(copia);
        };

        const depositosOrdenados = [...depositos].sort((a, b) => a.producto.localeCompare(b.producto));

        return (
          <>
            <Catalogo
              depositos={depositosOrdenados}
              alAgregar={agregar}
              alEditar={editar}
              alBorrar={borrar}
            />
          </>
        );
      }

      const rootElement = document.getElementById("root");
      ReactDOM.render(<App />, rootElement);
    </script>
  </body>
</html>
